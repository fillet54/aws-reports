{% extends "layout.html" %}

{% block title %}{{ brand.name }} – Brand Index{% endblock %}

{% block content %}
  <h1 class="text-3xl font-bold mb-4">{{ brand.name }}</h1>

  <p class="mb-4 text-sm text-base-content/70">
    Brand ID: <code>{{ brand.id }}</code>
  </p>

  {% if sales_summary %}
    <div class="grid gap-4 md:grid-cols-3 mb-6">
      <div class="card bg-base-100 shadow">
        <div class="card-body">
          <p class="text-sm text-base-content/70">Year to date</p>
          <h3 class="text-2xl font-semibold">
            ${{ "%.2f"|format(sales_summary.ytd) }}
          </h3>
          <p class="text-xs text-base-content/60">
            {{ sales_summary.ytd_start }} → {{ sales_summary.today }}
          </p>
        </div>
      </div>
      <div class="card bg-base-100 shadow">
        <div class="card-body">
          <p class="text-sm text-base-content/70">Month to date</p>
          <h3 class="text-2xl font-semibold">
            ${{ "%.2f"|format(sales_summary.mtd) }}
          </h3>
          <p class="text-xs text-base-content/60">
            {{ sales_summary.mtd_start }} → {{ sales_summary.today }}
          </p>
        </div>
      </div>
      <div class="card bg-base-100 shadow">
        <div class="card-body">
          <p class="text-sm text-base-content/70">Current week</p>
          <h3 class="text-2xl font-semibold">
            ${{ "%.2f"|format(sales_summary.week) }}
          </h3>
          <p class="text-xs text-base-content/60">
            {{ sales_summary.week_start }} → {{ sales_summary.today }}
          </p>
        </div>
      </div>
    </div>
  {% endif %}

  {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
      <div class="mb-4 space-y-2">
        {% for category, message in messages %}
          <div class="alert {{ 'alert-error' if category == 'error' else 'alert-success' }}">
            <span>{{ message }}</span>
          </div>
        {% endfor %}
      </div>
    {% endif %}
  {% endwith %}

  <div class="grid gap-6 md:grid-cols-2">
    <!-- Left: navigation / actions -->
    <div class="space-y-4">
      <div class="flex gap-2">
        <a class="btn btn-outline" href="{{ url_for('index') }}">Change brand</a>
        <a class="btn btn-secondary" href="{{ url_for('edit_brand', brand_id=brand.id) }}">
          Edit brand
        </a>
        <a class="btn btn-primary" href="{{ url_for('brand_reports', brand_id=brand.id) }}">
          Monthly reports
        </a>
        <a class="btn btn-primary btn-outline" href="{{ url_for('brand_weekly_reports', brand_id=brand.id) }}">
          Weekly report
        </a>
        <a class="btn btn-primary" href="{{ url_for('asin_meta_index', brand_id=brand.id) }}">
          Edit ASINs 
        </a>
      </div>

      <div class="card bg-base-100 shadow">
        <div class="card-body">
          <h2 class="card-title">Brand dashboard</h2>
          <p>TODO: show reports and stats for {{ brand.name }} here.</p>
        </div>
      </div>
    </div>

    <!-- Right: import orders report -->
    <div>
      <div class="card bg-base-100 shadow">
        <div class="card-body">
          <h2 class="card-title">Import orders report</h2>
          <p class="text-sm text-base-content/70 mb-2">
            Upload a CSV orders report for this brand. The data will be imported into
            the SQLite database, and the original CSV will be archived.
          </p>
          {% if latest_updated_date %}
            <div class="alert alert-info mb-3">
              <div>
                <p class="font-semibold">Latest last-updated-date in DB</p>
                <p class="text-sm">Up to {{ latest_updated_date }} (use this when picking an export range).</p>
              </div>
            </div>
          {% endif %}

          <form
            method="post"
            action="{{ url_for('import_orders_report', brand_id=brand.id) }}"
            enctype="multipart/form-data"
            class="space-y-4"
          >
            <label class="form-control w-full">
              <div class="label">
                <span class="label-text font-semibold">Orders report (.csv)</span>
              </div>
              <input
                type="file"
                name="report_file"
                accept=".csv,text/csv"
                class="file-input file-input-bordered w-full"
                required
              >
            </label>

            <div class="card-actions justify-end">
              <button class="btn btn-primary" type="submit">
                Import report
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
{% endblock %}
